{% extends "base.html" %}
{% block title %}System Dashboard - Gatekeeper{% endblock %}

{% block content %}
<h1>System Dashboard</h1>

<div class="grid">
    <article>
        <header>Users</header>
        <p style="font-size: 2rem; font-weight: bold;">{{ user_count }}</p>
    </article>
    <article>
        <header>Groups</header>
        <p style="font-size: 2rem; font-weight: bold;">{{ group_count }}</p>
    </article>
    <article>
        <header>API Keys</header>
        <p style="font-size: 2rem; font-weight: bold;">{{ key_count }}</p>
    </article>
</div>

<h2>Actions</h2>
<div role="group">
    <form method="post" action="{{ url_for('admin_system.rotate_app_salt') }}" style="display: inline;">
        <button type="submit" class="secondary"
                onclick="return confirm('This will invalidate ALL user sessions. Continue?')">
            Rotate App Salt
        </button>
    </form>
    <a href="{{ url_for('admin_system.backup') }}" role="button" class="outline">Download Backup</a>
    <a href="{{ url_for('admin_system.audit_log') }}" role="button" class="outline">View Audit Log</a>
</div>

<h2>Recent Activity</h2>
<figure>
    <table>
        <thead>
            <tr>
                <th>Timestamp</th>
                <th>Actor</th>
                <th>Action</th>
                <th>Target</th>
                <th>Details</th>
            </tr>
        </thead>
        <tbody>
            {% for entry in recent_audit %}
            <tr>
                <td>{{ entry.timestamp | localdatetime }}</td>
                <td>{{ entry.actor or "-" }}</td>
                <td>{{ entry.action }}</td>
                <td>{{ entry.target or "-" }}</td>
                <td><small>{{ entry.details or "-" }}</small></td>
            </tr>
            {% else %}
            <tr>
                <td colspan="5"><em>No recent activity.</em></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</figure>
{% endblock %}
