{% extends "base.html" %}
{% block title %}{{ "Edit User" if user else "Create User" }} - Gatekeeper{% endblock %}

{% block content %}
<h1>{% if user %}Edit User: {{ user.username }}{% else %}Create User{% endif %}</h1>

<form method="post"
      action="{{ url_for('admin_users.edit_user', username=user.username) if user else url_for('admin_users.create_user') }}">
    <label for="username">
        Username
        <input type="text" id="username" name="username" required autofocus
               value="{{ user.username if user else '' }}"
               placeholder="e.g. DOMAIN\jsmith or jsmith">
    </label>

    <label for="email">
        Email
        <input type="email" id="email" name="email" required
               value="{{ user.email if user else '' }}"
               placeholder="user@example.com"
               >
    </label>

    <label for="fullname">
        Full Name
        <input type="text" id="fullname" name="fullname"
               value="{{ user.fullname if user else '' }}"
               placeholder="Jane Smith">
    </label>

    <fieldset>
        <label>
            <input type="checkbox" name="enabled" role="switch"
                   {{ "checked" if (user.enabled if user else true) }}>
            Enabled
        </label>
    </fieldset>

    <div style="display: flex; gap: 1rem; align-items: center;">
        <button type="submit">{{ "Save" if user else "Create" }}</button>
        <button type="button" class="outline secondary" onclick="location.href='{{ url_for('admin_users.list_users') }}'">Cancel</button>
    </div>
</form>

{% if user %}
<hr>
<h2>Groups</h2>
<p>
    {% for grp in groups %}<mark style="margin-right: 0.25rem;">{{ grp }}</mark>{% else %}None{% endfor %}
</p>
<button type="button" class="outline" onclick="location.href='{{ url_for('admin_users.user_groups', username=user.username) }}'">Edit group memberships...</button>

<hr>
<h2>Properties</h2>
{% include "admin/user_properties_list.html" %}

<hr>
<h2>Delete user</h2>
<form method="post" action="{{ url_for('admin_users.delete_user', username=user.username) }}"
      onsubmit="return confirm('Permanently delete user \'{{ user.username }}\'? This cannot be undone.');">
    <button type="submit" class="secondary">Delete User</button>
</form>
{% endif %}
{% endblock %}
