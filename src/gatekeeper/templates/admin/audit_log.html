{% extends "base.html" %}
{% block title %}Audit Log - Gatekeeper{% endblock %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center;">
    <h1>Audit Log</h1>
    <button type="button" class="secondary outline" onclick="location.href='{{ url_for('admin_system.audit_log_export') }}'">Export</button>
</div>

<p><small>Showing page {{ page }} of {{ total_pages }} ({{ total }} entries)</small></p>

<figure>
    <table>
        <thead>
            <tr>
                <th>Timestamp</th>
                <th>Actor</th>
                <th>Action</th>
                <th>Target</th>
                <th>Details</th>
            </tr>
        </thead>
        <tbody>
            {% for entry in entries %}
            <tr>
                <td>{{ entry.timestamp | localdatetime }}</td>
                <td>{{ entry.actor or "-" }}</td>
                <td>{{ entry.action }}</td>
                <td>{{ entry.target or "-" }}</td>
                <td>
                    {% if entry.details and entry.details.startswith("{") %}
                    <pre><code>{{ entry.details | tojson_pretty }}</code></pre>
                    {% else %}
                    <small>{{ entry.details or "-" }}</small>
                    {% endif %}
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="5"><em>No audit log entries.</em></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</figure>

<nav>
    <ul>
        <li>
            {% if page > 1 %}
            <a href="{{ url_for('admin_system.audit_log', page=page - 1, per_page=per_page) }}">&laquo; Previous</a>
            {% endif %}
        </li>
    </ul>
    <ul>
        <li>
            {% if page < total_pages %}
            <a href="{{ url_for('admin_system.audit_log', page=page + 1, per_page=per_page) }}">Next &raquo;</a>
            {% endif %}
        </li>
    </ul>
</nav>
{% endblock %}
